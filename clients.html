<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>UBA Clients</title>
    <link rel="stylesheet" href="assets/css/style.css" />
  </head>
  <body>
    <section id="uba-dashboard">
      <div id="page-id" data-page="clients-page">
        <div class="uba-shell">
          <aside class="uba-sidebar">
            <div>
              <div class="uba-logo">MHM <span>UBA</span></div>
              <p class="uba-tagline" data-i18n="app.tagline">
                Universal Business Automator ‚Äî one workspace for clients, tasks,
                invoices and smart tools.
              </p>
              <div class="uba-badge">
                <span class="uba-badge-dot"></span>
                <span data-i18n="app.badge">
                  Private beta ¬∑ Built in the Netherlands
                </span>
              </div>
            </div>

            <div class="uba-language">
              <label for="language-select" data-i18n="language.label"
                >Language</label
              >
              <select id="language-select">
                <option value="en" data-i18n="language.en">English</option>
                <option value="ar" data-i18n="language.ar">Arabic</option>
                <option value="nl" data-i18n="language.nl">Dutch</option>
                <option value="fr" data-i18n="language.fr">French</option>
                <option value="es" data-i18n="language.es">Spanish</option>
                <option value="de" data-i18n="language.de">German</option>
              </select>
            </div>

            <div>
              <div class="uba-nav-label" data-i18n="nav.workspaceLabel">
                Workspace
              </div>
              <nav class="uba-nav">
                <a class="uba-nav-btn" href="index.html">
                  <span class="icon">üìà</span>
                  <span data-i18n="nav.dashboard">Dashboard</span>
                  <small data-i18n="nav.dashboardSub">Overview</small>
                </a>
                <a class="uba-nav-btn active" href="clients.html">
                  <span class="icon">üßë‚Äçüíª</span>
                  <span data-i18n="nav.clients">Clients</span>
                  <small data-i18n="nav.clientsSub">CRM</small>
                </a>
                <a class="uba-nav-btn" href="projects.html">
                  <span class="icon">üíº</span>
                  <span data-i18n="nav.projects">Projects</span>
                  <small data-i18n="nav.projectsSub">Pipeline</small>
                </a>
                <a class="uba-nav-btn" href="tasks.html">
                  <span class="icon">‚úÖ</span>
                  <span data-i18n="nav.tasks">Tasks</span>
                  <small data-i18n="nav.tasksSub">Today</small>
                </a>
                <a class="uba-nav-btn" href="invoices.html">
                  <span class="icon">üíµ</span>
                  <span data-i18n="nav.invoices">Invoices</span>
                  <small data-i18n="nav.invoicesSub">Billing</small>
                </a>
                <a class="uba-nav-btn" href="automations.html">
                  <span class="icon">ü§ñ</span>
                  <span data-i18n="nav.automations">Automations</span>
                  <small data-i18n="nav.automationsSub">Flows</small>
                </a>
                <a class="uba-nav-btn" href="calendar.html">
                  <span class="icon">üìÖ</span>
                  <span>Calendar</span>
                </a>
                <a class="uba-nav-btn" href="leads.html">
                  <span class="icon">üß≤</span>
                  <span>Leads</span>
                </a>
                <a class="uba-nav-btn" href="expenses.html">
                  <span class="icon">üì§</span>
                  <span>Expenses</span>
                </a>
                <a class="uba-nav-btn" href="files.html">
                  <span class="icon">üìÅ</span>
                  <span>Files</span>
                </a>
                <a class="uba-nav-btn" href="reports.html">
                  <span class="icon">üìë</span>
                  <span>Reports</span>
                </a>
                <a class="uba-nav-btn" href="smart-tools.html">
                  <span class="icon">üß†</span>
                  <span data-i18n="nav.smartTools">UBA Smart Tools</span>
                  <small data-i18n="nav.smartToolsSub">AI ops</small>
                </a>
                <a class="uba-nav-btn" href="insights.html">
                  <span class="icon">üìä</span>
                  <span data-i18n="nav.insights">Insights Lab</span>
                  <small data-i18n="nav.insightsSub">Reports</small>
                </a>
                <a class="uba-nav-btn" href="help.html">
                  <span class="icon">üí¨</span>
                  <span data-i18n="nav.support">Success Desk</span>
                  <small data-i18n="nav.supportSub">Guidance</small>
                </a>
                <a class="uba-nav-btn" href="settings.html">
                  <span class="icon">üõ†Ô∏è</span>
                  <span data-i18n="nav.settings">Settings</span>
                  <small data-i18n="nav.settingsSub">Workspace</small>
                </a>
              </nav>
            </div>

            <div class="uba-sidebar-footer" data-i18n="sidebar.footer">
              Designed for small teams and solo founders who are tired of 7
              different tools just to run one business.
            </div>
          </aside>

          <main class="uba-main">
            <header class="uba-topbar">
              <div class="uba-top-left">
                <p class="uba-top-kicker">CRM</p>
                <h1 id="uba-view-title" data-i18n="view.clients.title">
                  Clients
                </h1>
                <p id="uba-view-desc" data-i18n="view.clients.desc">
                  Local CRM board with quick add, edit, and delete.
                </p>
              </div>
              <div class="uba-top-right">
                <select id="workspace-select" class="uba-select">
                  <option>Main workspace</option>
                </select>
                <div class="uba-user-pill">
                  <span class="uba-avatar"></span
                  ><span id="uba-user-label">Admin</span>
                </div>
              </div>
            </header>

            <div class="uba-views">
              <section class="uba-view" data-view="clients">
                <div class="uba-grid">
                  <div class="uba-grid-col">
                    <section class="uba-card" id="clients-page">
                      <div class="uba-card-header">
                        <div>
                          <div
                            class="uba-card-title"
                            data-i18n="view.clients.title"
                          >
                            Clients
                          </div>
                          <p class="uba-card-sub" data-i18n="view.clients.desc">
                            Local CRM board with quick add, edit, and delete.
                          </p>
                        </div>
                        <span class="uba-pill" data-i18n="view.clients.badge"
                          >Local CRM</span
                        >
                      </div>
                      
                      <!-- Enhanced Clients Toolbar -->
                      <div class="uba-table-toolbar">
                        <div class="uba-toolbar-left">
                          <input 
                            type="text" 
                            id="clients-search" 
                            class="uba-input-sm" 
                            placeholder="Search clients..."
                            data-i18n-placeholder="clients.search"
                          />
                          <select id="clients-sort" class="uba-select-sm">
                            <option value="name_asc">Name A-Z</option>
                            <option value="name_desc">Name Z-A</option>
                            <option value="created_at_desc">Newest First</option>
                            <option value="created_at_asc">Oldest First</option>
                            <option value="company_asc">Company A-Z</option>
                          </select>
                        </div>
                        <div class="uba-toolbar-right">
                          <select id="clients-page-size" class="uba-select-sm">
                            <option value="10">10 per page</option>
                            <option value="20" selected>20 per page</option>
                            <option value="50">50 per page</option>
                            <option value="100">100 per page</option>
                          </select>
                          <button type="button" class="uba-btn-sm uba-btn-ghost" onclick="showCustomFieldsModal()">
                            ‚öôÔ∏è Custom Fields
                          </button>
                        </div>
                      </div>

                      <form id="clients-page-form" class="uba-form">
                        <input type="hidden" id="clients-edit-id" />
                        <div class="uba-form-row">
                          <input
                            type="text"
                            id="clients-name"
                            placeholder="Client name"
                            data-i18n-placeholder="form.clientName"
                            required
                          />
                          <input
                            type="email"
                            id="clients-email"
                            placeholder="Email"
                            data-i18n-placeholder="form.email"
                          />
                        </div>

                        <div class="uba-form-row">
                          <input
                            type="text"
                            id="clients-company"
                            placeholder="Company"
                            data-i18n-placeholder="form.company"
                          />
                          <input
                            type="text"
                            id="clients-phone"
                            placeholder="Phone"
                            data-i18n-placeholder="form.phone"
                          />
                        </div>
                        
                        <!-- Custom Fields Section -->
                        <div id="custom-fields-container" class="uba-custom-fields">
                          <div class="uba-form-section-header">
                            <span>Additional Information</span>
                            <button type="button" class="uba-btn-sm uba-btn-ghost" onclick="toggleCustomFields()">
                              <span id="custom-fields-toggle">‚ñº</span>
                            </button>
                          </div>
                          <div id="custom-fields-content" class="uba-custom-fields-content" style="display: none;">
                            <!-- Custom fields will be dynamically inserted here -->
                          </div>
                        </div>

                        <div class="uba-form-row">
                          <input
                            type="text"
                            id="clients-notes"
                            placeholder="Notes"
                            data-i18n-placeholder="form.notes"
                          />
                          <button
                            type="submit"
                            class="uba-btn-primary"
                            data-i18n="form.saveClient"
                          >
                            Save client
                          </button>
                        </div>
                        <p
                          id="clients-page-error"
                          class="uba-text-danger"
                          aria-live="polite"
                        ></p>
                      </form>

                      <div class="uba-table-wrap">
                        <table class="uba-table">
                          <thead>
                            <tr>
                              <th data-i18n="table.name">Name</th>
                              <th data-i18n="table.company">Company</th>
                              <th data-i18n="table.email">Email</th>
                              <th data-i18n="table.phone">Phone</th>
                              <th
                                style="width: 120px"
                                data-i18n="table.actions"
                              >
                                Actions
                              </th>
                            </tr>
                          </thead>
                          <tbody id="clients-page-table">
                            <tr>
                              <td colspan="5" data-i18n="clients.loading">
                                Loading‚Ä¶
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </section>
                  </div>

                  <div class="uba-grid-col">
                    <section class="uba-card">
                      <div class="uba-card-header">
                        <div>
                          <div
                            class="uba-card-title"
                            data-i18n="view.clients.summary"
                          >
                            Client snapshot
                          </div>
                          <p
                            class="uba-card-sub"
                            data-i18n="view.clients.summaryDesc"
                          >
                            Quick health of your local CRM list.
                          </p>
                        </div>
                        <span class="uba-pill" data-i18n="view.clients.local"
                          >Local only</span
                        >
                      </div>

                      <div class="uba-kpi-strip">
                        <div class="uba-kpi">
                          <div
                            class="uba-kpi-label"
                            data-i18n="view.clients.total"
                          >
                            Total clients
                          </div>
                          <div class="uba-kpi-value" id="clients-total">0</div>
                          <div
                            class="uba-kpi-trend"
                            id="clients-highlight"
                            data-i18n="view.clients.tip"
                          >
                            Add a client to get started.
                          </div>
                        </div>
                        <div class="uba-kpi">
                          <div
                            class="uba-kpi-label"
                            data-i18n="view.clients.recent"
                          >
                            Recent note
                          </div>
                          <div class="uba-kpi-value" id="clients-recent">‚Äì</div>
                          <div
                            class="uba-kpi-trend"
                            data-i18n="view.clients.recentTip"
                          >
                            Pulled from latest saved contact.
                          </div>
                        </div>
                      </div>

                      <div class="uba-support-grid">
                        <div class="uba-support-card">
                          <div class="uba-support-icon">üß≠</div>
                          <div>
                            <h4 data-i18n="view.clients.hintTitle">
                              Keep records tidy
                            </h4>
                            <p data-i18n="view.clients.hintDesc">
                              Use the notes field for renewal dates, goals, or
                              active projects.
                            </p>
                          </div>
                        </div>
                        <div class="uba-support-card">
                          <div class="uba-support-icon">üîÑ</div>
                          <div>
                            <h4 data-i18n="view.clients.localTitle">
                              Local-first
                            </h4>
                            <p data-i18n="view.clients.localDesc">
                              Data is stored in your browser. Export or sync
                              later.
                            </p>
                          </div>
                        </div>
                      </div>
                    </section>
                  </div>
                </div>
              </section>
            </div>
          </main>
        </div>
      </div>
    </section>

    <!-- Custom Fields Configuration Modal -->
    <div id="custom-fields-modal" class="uba-modal" style="display: none;">
      <div class="uba-modal-overlay" onclick="closeCustomFieldsModal()"></div>
      <div class="uba-modal-content">
        <div class="uba-modal-header">
          <h3>Configure Custom Fields</h3>
          <button type="button" class="uba-modal-close" onclick="closeCustomFieldsModal()">√ó</button>
        </div>
        <div class="uba-modal-body">
          <p>Customize additional fields to capture client-specific information:</p>
          <div id="custom-fields-config">
            <!-- Custom fields configuration will be rendered here -->
          </div>
          <button type="button" class="uba-btn-sm uba-btn-ghost" onclick="addCustomField()">+ Add Field</button>
        </div>
        <div class="uba-modal-footer">
          <button type="button" class="uba-btn-ghost" onclick="closeCustomFieldsModal()">Cancel</button>
          <button type="button" class="uba-btn-primary" onclick="saveCustomFields()">Save Fields</button>
        </div>
      </div>
    </div>

    <!-- Client Details Modal -->
    <div id="client-details-modal" class="uba-modal" style="display: none;">
      <div class="uba-modal-overlay" onclick="closeClientDetailsModal()"></div>
      <div class="uba-modal-content uba-modal-large">
        <div class="uba-modal-header">
          <h3 id="client-details-title">Client Details</h3>
          <button type="button" class="uba-modal-close" onclick="closeClientDetailsModal()">√ó</button>
        </div>
        <div class="uba-modal-body">
          <div class="uba-client-details">
            <div id="client-basic-info" class="uba-details-section">
              <!-- Basic client info will be rendered here -->
            </div>
            <div id="client-custom-info" class="uba-details-section">
              <!-- Custom fields info will be rendered here -->
            </div>
            <div id="client-relationships" class="uba-details-section">
              <h4>Related Projects & Invoices</h4>
              <div id="related-projects" class="uba-related-items">
                <!-- Related projects will be rendered here -->
              </div>
              <div id="related-invoices" class="uba-related-items">
                <!-- Related invoices will be rendered here -->
              </div>
            </div>
          </div>
        </div>
        <div class="uba-modal-footer">
          <button type="button" class="uba-btn-ghost" onclick="closeClientDetailsModal()">Close</button>
          <button type="button" class="uba-btn-primary" onclick="editClientFromDetails()">Edit Client</button>
        </div>
      </div>
    </div>

    
    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Supabase Config (if exists) -->
    <script>
      // Try to load config, fail silently if not found
      const script = document.createElement('script');
      script.src = 'supabase-config.js';
      script.onerror = () => console.warn('[Auth] supabase-config.js not found - running in local/demo mode');
      document.head.appendChild(script);
    </script>
    
    <!-- Supabase API Service -->
    <script src="assets/js/supabase-api-service.js"></script>
    
    <!-- Auth Guard (protect this page) -->
    <script src="assets/js/auth-guard.js"></script>
    
    <script src="assets/js/i18n.js"></script>
    <script src="assets/js/store.js"></script>
    <script src="assets/js/data-layer.js"></script>
    <script src="assets/js/validation.js"></script>
    <script src="assets/js/enhanced-clients.js"></script>
    <script src="assets/js/client-relationships.js"></script>
    <script src="assets/js/app.js"></script>
    <script src="assets/js/page-loader.js"></script>
    <script src="assets/js/assistant.js"></script>
    <script src="assets/js/clients.js"></script>
    <script>
      (function () {
        const lang = localStorage.getItem("uba-lang") || "en";
        if (
          window.ubaI18n &&
          typeof window.ubaI18n.applyTranslations === "function"
        ) {
          window.ubaI18n.applyTranslations(lang);
        }
        if (lang === "ar") document.documentElement.dir = "rtl";
      })();
    </script>
    <script>
      try {
        const pageId = document.getElementById("page-id")?.dataset?.page;
        if (pageId && typeof loadPageScripts === "function")
          loadPageScripts(pageId);
      } catch (err) {
        console.warn("page-loader: failed to run loadPageScripts", err);
      }
    </script>
  </body>
</html>
