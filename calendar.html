<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UBA Calendar</title>
  <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body>
  <section id="uba-dashboard">
    <div class="uba-shell">
      <aside class="uba-sidebar">
        <div>
          <div class="uba-logo">
            MHM <span>UBA</span>
          </div>
          <p class="uba-tagline" data-i18n="app.tagline">
            Universal Business Automator â€” one workspace for clients, tasks, invoices and smart tools.
          </p>
          <div class="uba-badge">
            <span class="uba-badge-dot"></span>
            <span data-i18n="app.badge">Private beta Â· Built in the Netherlands</span>
          </div>
        </div>

        <div class="uba-language">
          <label for="language-select" data-i18n="language.label">Language</label>
          <select id="language-select">
            <option value="en" data-i18n="language.en">English</option>
            <option value="ar" data-i18n="language.ar">Arabic</option>
            <option value="nl" data-i18n="language.nl">Dutch</option>
            <option value="fr" data-i18n="language.fr">French</option>
            <option value="es" data-i18n="language.es">Spanish</option>
            <option value="de" data-i18n="language.de">German</option>
          </select>
        </div>

        <div>
          <div class="uba-nav-label" data-i18n="nav.workspaceLabel">Workspace</div>
          <nav class="uba-nav">
            <a class="uba-nav-btn" href="index.html">
              <span class="icon">ğŸ“ˆ</span>
              <span data-i18n="nav.dashboard">Dashboard</span>
              <small data-i18n="nav.dashboardSub">Overview</small>
            </a>
            <a class="uba-nav-btn" href="clients.html">
              <span class="icon">ğŸ§‘â€ğŸ’»</span>
              <span data-i18n="nav.clients">Clients</span>
              <small data-i18n="nav.clientsSub">CRM</small>
            </a>
            <a class="uba-nav-btn" href="projects.html">
              <span class="icon">ğŸ’¼</span>
              <span data-i18n="nav.projects">Projects</span>
              <small data-i18n="nav.projectsSub">Pipeline</small>
            </a>
            <a class="uba-nav-btn" href="tasks.html">
              <span class="icon">âœ…</span>
              <span data-i18n="nav.tasks">Tasks</span>
              <small data-i18n="nav.tasksSub">Today</small>
            </a>
            <a class="uba-nav-btn" href="invoices.html">
              <span class="icon">ğŸ’µ</span>
              <span data-i18n="nav.invoices">Invoices</span>
              <small data-i18n="nav.invoicesSub">Billing</small>
            </a>
            <a class="uba-nav-btn active" href="calendar.html">
              <span class="icon">ğŸ“…</span>
              <span>Calendar</span>
            </a>
            <a class="uba-nav-btn" href="leads.html">
              <span class="icon">ğŸ§²</span>
              <span>Leads</span>
            </a>
            <a class="uba-nav-btn" href="expenses.html">
              <span class="icon">ğŸ“¤</span>
              <span>Expenses</span>
            </a>
            <a class="uba-nav-btn" href="files.html">
              <span class="icon">ğŸ“</span>
              <span>Files</span>
            </a>
            <a class="uba-nav-btn" href="reports.html">
              <span class="icon">ğŸ“‘</span>
              <span>Reports</span>
            </a>
            <a class="uba-nav-btn" href="smart-tools.html">
              <span class="icon">ğŸ§ </span>
              <span data-i18n="nav.smartTools">UBA Smart Tools</span>
              <small data-i18n="nav.smartToolsSub">AI ops</small>
            </a>
            <a class="uba-nav-btn" href="insights.html">
              <span class="icon">ğŸ“Š</span>
              <span data-i18n="nav.insights">Insights Lab</span>
              <small data-i18n="nav.insightsSub">Reports</small>
            </a>
            <a class="uba-nav-btn" href="help.html">
              <span class="icon">ğŸ’¬</span>
              <span data-i18n="nav.support">Success Desk</span>
              <small data-i18n="nav.supportSub">Guidance</small>
            </a>
            <a class="uba-nav-btn" href="settings.html">
              <span class="icon">ğŸ› ï¸</span>
              <span data-i18n="nav.settings">Settings</span>
              <small data-i18n="nav.settingsSub">Workspace</small>
            </a>
          </nav>
        </div>

        <div class="uba-sidebar-footer" data-i18n="sidebar.footer">Designed for small teams and solo founders who are tired of 7 different tools just to run one business.</div>
      </aside>

      <main class="uba-main">
        <header class="uba-topbar">
          <div class="uba-top-left">
            <p class="uba-top-kicker">Calendar</p>
            <h1 id="uba-view-title">Calendar</h1>
            <p id="uba-view-desc">Month view of events and deadlines.</p>
          </div>
          <div class="uba-top-right">
            <div class="uba-btn-ghost" style="align-self:center;">Filter: <span id="calendar-filter">All</span></div>
          </div>
        </header>

        <div class="uba-views">
          <section class="uba-view" data-view="calendar">
            <div class="uba-card">
              <div class="uba-card-header">
                <div>
                  <div class="uba-card-title">Calendar</div>
                  <p class="uba-card-sub">Filter and browse events</p>
                </div>
                <div class="uba-pill">Month</div>
              </div>

              <div style="padding:12px;">
                <div style="display:flex;gap:8px;margin-bottom:12px;" class="assistant-questions">
                  <button class="uba-pill" data-filter="all">All</button>
                  <button class="uba-pill" data-filter="client">Clients</button>
                  <button class="uba-pill" data-filter="project">Projects</button>
                  <button class="uba-pill" data-filter="invoice">Invoices</button>
                </div>

                <div id="calendar-grid" class="uba-calendar-grid"></div>
              </div>
            </div>
          </section>
        </div>
      </main>
    </div>
  </section>

  <script src="assets/js/i18n.js"></script>
  <script src="assets/js/store.js"></script>
  <script src="assets/js/app.js"></script>
  <script src="assets/js/uba-pages-data.js"></script>
  <script src="assets/js/assistant.js"></script>
  <script>
    (function () {
      // Simple month grid for November 2025 (start on Sunday)
      const grid = document.getElementById('calendar-grid');
      const store = window.ubaStore;

      // Aggregate events from local store: invoices (due), tasks (due), projects (items with due)
      const events = [];

      try {
        if (store && store.invoices && store.invoices.getAll) {
          const invs = store.invoices.getAll() || [];
          invs.forEach(i => {
            if (i.due) events.push({ id: `inv-${i.id}`, date: i.due, type: 'invoice', title: `${i.label || 'Invoice'} â€” ${i.client || ''}`, time: i.time || '' });
          });
        }

        if (store && store.tasks && store.tasks.getAll) {
          const tasksRaw = store.tasks.getAll() || [];
          // board-style (columns) or flat list
          if (Array.isArray(tasksRaw) && tasksRaw.length && tasksRaw[0].tasks) {
            tasksRaw.forEach(col => (col.tasks || []).forEach(t => { if (t.due && /^\d{4}-\d{2}-\d{2}/.test(t.due)) events.push({ id: `task-${t.id}`, date: t.due, type: 'project', title: t.title, time: t.time || '' }); }));
          } else if (Array.isArray(tasksRaw)) {
            tasksRaw.forEach(t => { if (t.due && /^\d{4}-\d{2}-\d{2}/.test(t.due)) events.push({ id: `task-${t.id}`, date: t.due, type: 'project', title: t.title, time: t.time || '' }); });
          }
        }

        if (store && store.projects && store.projects.getAll) {
          const projectsRaw = store.projects.getAll() || [];
          // stages with items
          if (Array.isArray(projectsRaw)) {
            projectsRaw.forEach(stage => { (stage.items || []).forEach(it => { if (it.due || it.date) { const d = it.due || it.date; if (/^\d{4}-\d{2}-\d{2}/.test(d)) events.push({ id: `proj-${it.id}`, date: d, type: 'project', title: it.name || it.title || 'Project milestone', time: it.time || '' }); } }); });
          }
        }

        // fallback demo events appended last
        if (window.ubaCalendarEvents && Array.isArray(window.ubaCalendarEvents)) {
          window.ubaCalendarEvents.forEach(e => events.push(e));
        }
      } catch (e) {
        console.warn('calendar aggregate error', e);
      }
      const filterButtons = document.querySelectorAll('[data-filter]');
      let currentFilter = 'all';

      function render() {
        grid.innerHTML = '';
        // display 30 days for simplicity
        for (let d = 1; d <= 30; d++) {
          const day = document.createElement('div');
          day.className = 'uba-card uba-calendar-day';
          const dateStr = `2025-11-${String(d).padStart(2,'0')}`;
          const title = document.createElement('div');
          title.className = 'calendar-day-label';
          title.style.marginBottom = '6px';
          title.textContent = `Nov ${d}`;
          day.appendChild(title);
          const list = document.createElement('div');
          list.className = 'calendar-events';
          const todays = events.filter(e => e.date === dateStr && (currentFilter === 'all' || e.type === currentFilter));
          if (todays.length) {
            todays.forEach(ev => {
              const evDiv = document.createElement('div');
              evDiv.className = 'uba-support-card calendar-event-card';
              evDiv.innerHTML = `<div style="width:36px;">${ev.time}</div><div><strong>${ev.title}</strong><div style="font-size:12px;color:var(--muted)">${ev.type}</div></div>`;
              list.appendChild(evDiv);
            });
          } else {
            const empty = document.createElement('div');
            empty.className = 'calendar-empty';
            empty.textContent = 'â€”';
            list.appendChild(empty);
          }
          day.appendChild(list);
          grid.appendChild(day);
        }
      }

      filterButtons.forEach(b => {
        b.addEventListener('click', () => {
          currentFilter = b.getAttribute('data-filter');
          document.getElementById('calendar-filter').textContent = b.textContent;
          render();
        });
      });

      render();
      if (window.ubaI18n && window.ubaI18n.applyTranslations) window.ubaI18n.applyTranslations(localStorage.getItem('uba-lang')||'en');
    })();
  </script>
</body>
</html>