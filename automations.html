<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>UBA Automations</title>
    <link rel="stylesheet" href="assets/css/style.css" />
  </head>
  <body>
    <section id="uba-dashboard">
      <div id="page-id" data-page="automations-page">
        <div class="uba-shell">
          <aside class="uba-sidebar">
            <div>
              <div class="uba-logo">MHM <span>UBA</span></div>
              <p class="uba-tagline" data-i18n="app.tagline">
                Universal Business Automator ‚Äî one workspace for clients, tasks,
                invoices and smart tools.
              </p>
              <div class="uba-badge">
                <span class="uba-badge-dot"></span
                ><span data-i18n="app.badge">
                  Private beta ¬∑ Built in the Netherlands
                </span>
              </div>
            </div>

            <div class="uba-language">
              <label for="language-select" data-i18n="language.label"
                >Language</label
              >
              <select id="language-select">
                <option value="en" data-i18n="language.en">English</option>
                <option value="ar" data-i18n="language.ar">Arabic</option>
                <option value="nl" data-i18n="language.nl">Dutch</option>
                <option value="fr" data-i18n="language.fr">French</option>
                <option value="es" data-i18n="language.es">Spanish</option>
                <option value="de" data-i18n="language.de">German</option>
              </select>
            </div>

            <div>
              <div class="uba-nav-label" data-i18n="nav.workspaceLabel">
                Workspace
              </div>
              <nav class="uba-nav">
                <a class="uba-nav-btn" href="index.html"
                  ><span class="icon">üìà</span>
                  <span data-i18n="nav.dashboard">Dashboard</span>
                  <small data-i18n="nav.dashboardSub">Overview</small></a
                >
                <a class="uba-nav-btn" href="clients.html"
                  ><span class="icon">üßë‚Äçüíª</span>
                  <span data-i18n="nav.clients">Clients</span>
                  <small data-i18n="nav.clientsSub">CRM</small></a
                >
                <a class="uba-nav-btn" href="projects.html"
                  ><span class="icon">üíº</span>
                  <span data-i18n="nav.projects">Projects</span>
                  <small data-i18n="nav.projectsSub">Pipeline</small></a
                >
                <a class="uba-nav-btn" href="tasks.html"
                  ><span class="icon">‚úÖ</span>
                  <span data-i18n="nav.tasks">Tasks</span>
                  <small data-i18n="nav.tasksSub">Today</small></a
                >
                <a class="uba-nav-btn" href="invoices.html"
                  ><span class="icon">üíµ</span>
                  <span data-i18n="nav.invoices">Invoices</span>
                  <small data-i18n="nav.invoicesSub">Billing</small></a
                >
                <a class="uba-nav-btn active" href="automations.html"
                  ><span class="icon">ü§ñ</span>
                  <span data-i18n="nav.automations">Automations</span>
                  <small data-i18n="nav.automationsSub">Flows</small></a
                >
                <a class="uba-nav-btn" href="calendar.html"
                  ><span class="icon">üìÖ</span><span>Calendar</span></a
                >
                <a class="uba-nav-btn" href="leads.html"
                  ><span class="icon">üß≤</span><span>Leads</span></a
                >
                <a class="uba-nav-btn" href="expenses.html"
                  ><span class="icon">üì§</span><span>Expenses</span></a
                >
                <a class="uba-nav-btn" href="files.html"
                  ><span class="icon">üìÅ</span><span>Files</span></a
                >
                <a class="uba-nav-btn" href="reports.html"
                  ><span class="icon">üìë</span><span>Reports</span></a
                >
                <a class="uba-nav-btn" href="smart-tools.html"
                  ><span class="icon">üß†</span>
                  <span data-i18n="nav.smartTools">UBA Smart Tools</span>
                  <small data-i18n="nav.smartToolsSub">AI ops</small></a
                >
                <a class="uba-nav-btn" href="insights.html"
                  ><span class="icon">üìä</span>
                  <span data-i18n="nav.insights">Insights Lab</span>
                  <small data-i18n="nav.insightsSub">Reports</small></a
                >
                <a class="uba-nav-btn" href="help.html"
                  ><span class="icon">üí¨</span>
                  <span data-i18n="nav.support">Success Desk</span>
                  <small data-i18n="nav.supportSub">Guidance</small></a
                >
                <a class="uba-nav-btn" href="settings.html"
                  ><span class="icon">üõ†Ô∏è</span>
                  <span data-i18n="nav.settings">Settings</span>
                  <small data-i18n="nav.settingsSub">Workspace</small></a
                >
              </nav>
            </div>

            <div class="uba-sidebar-footer" data-i18n="sidebar.footer">
              Designed for small teams and solo founders who are tired of 7
              different tools just to run one business.
            </div>
          </aside>

          <main class="uba-main">
            <header class="uba-topbar">
              <div class="uba-top-left">
                <p class="uba-top-kicker">Automation</p>
                <h1 id="uba-view-title" data-i18n="view.automations.title">
                  Automations
                </h1>
                <p id="uba-view-desc" data-i18n="view.automations.desc">
                  Overview of flows with sample activity logs.
                </p>
              </div>
              <div class="uba-top-right">
                <select id="workspace-select" class="uba-select">
                  <option>Main workspace</option>
                </select>
                <div class="uba-user-pill">
                  <span class="uba-avatar"></span
                  ><span id="uba-user-label">Admin</span>
                </div>
              </div>
            </header>

            <div class="uba-views">
              <section class="uba-view" data-view="automations">
                <div class="uba-grid">
                  <div class="uba-grid-col">
                    <section class="uba-card" id="automations-page">
                      <div class="uba-card-header">
                        <div>
                          <div
                            class="uba-card-title"
                            data-i18n="view.automations.title"
                          >
                            Automations
                          </div>
                          <p
                            class="uba-card-sub"
                            data-i18n="view.automations.desc"
                          >
                            Create automation rules to streamline your workflow
                          </p>
                        </div>
                        <button id="new-automation-btn" class="uba-btn-primary">
                          <span data-i18n="automations.new">+ New Automation</span>
                        </button>
                      </div>

                      <div class="automations-meta">
                        <div>
                          <p class="label" data-i18n="automations.meta.count">
                            Active rules
                          </p>
                          <strong id="automation-count">0</strong>
                        </div>
                        <div>
                          <p class="label" data-i18n="automations.meta.runs">
                            Total runs
                          </p>
                          <strong id="automation-runs">0</strong>
                        </div>
                        <div class="mini-chip" data-i18n="view.automations.local">
                          Local only
                        </div>
                      </div>

                      <div class="uba-table-wrap">
                        <table class="uba-table">
                          <thead>
                            <tr>
                              <th data-i18n="table.name">Name</th>
                              <th data-i18n="automations.trigger">Trigger</th>
                              <th data-i18n="automations.action">Action</th>
                              <th data-i18n="table.status">Status</th>
                              <th data-i18n="automations.lastRun">Last Run</th>
                              <th style="width: 120px" data-i18n="table.actions">
                                Actions
                              </th>
                            </tr>
                          </thead>
                          <tbody id="automations-body">
                            <tr>
                              <td colspan="6" data-i18n="automations.empty">
                                No automations yet. Create your first rule.
                              </td>
                            </tr>
                          </tbody>
                          <tbody id="automations-body">
                            <tr>
                              <td colspan="5" data-i18n="automations.empty">
                                No automations yet. Create your first rule.
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </section>

                    <!-- Recent Runs Section -->
                    <section class="uba-card">
                      <div class="uba-card-header">
                        <div>
                          <div class="uba-card-title" data-i18n="automations.recentRuns">
                            Recent Runs
                          </div>
                          <p class="uba-card-sub" data-i18n="automations.recentRunsDesc">
                            History of automation executions
                          </p>
                        </div>
                        <button id="clear-logs-btn" class="uba-btn-ghost">
                          <span data-i18n="automations.clearLogs">Clear Logs</span>
                        </button>
                      </div>

                      <div class="uba-table-wrap">
                        <table class="uba-table">
                          <thead>
                            <tr>
                              <th data-i18n="automations.logRule">Rule Name</th>
                              <th data-i18n="automations.logTrigger">Trigger Type</th>
                              <th data-i18n="automations.logResult">Status</th>
                              <th data-i18n="automations.logPayload">Details</th>
                              <th data-i18n="automations.logTime">Time</th>
                            </tr>
                          </thead>
                          <tbody id="automation-logs-body">
                            <tr>
                              <td colspan="4" data-i18n="automations.noLogs">
                                No automation runs yet.
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </section>
                  </div>
                </div>
              </section>
            </div>

            <!-- Automation Modal -->
            <div id="automation-modal" class="uba-modal" style="display: none;">
              <div class="uba-modal-backdrop" onclick="closeAutomationModal()"></div>
              <div class="uba-modal-dialog">
                <div class="uba-modal-header">
                  <h3 id="automation-modal-title" data-i18n="automations.new">New Automation</h3>
                  <button class="uba-modal-close" onclick="closeAutomationModal()">&times;</button>
                </div>
                <div class="uba-modal-body">
                  <form id="automation-form" class="uba-form">
                    <input type="hidden" id="automation-edit-id" />
                    
                    <div class="uba-form-group">
                      <label for="automation-name" data-i18n="table.name">Name</label>
                      <input
                        type="text"
                        id="automation-name"
                        class="uba-input"
                        placeholder="e.g., Create follow-up task for overdue invoices"
                        required
                      />
                    </div>

                    <div class="uba-form-group">
                      <label for="automation-description" data-i18n="table.description">Description (Optional)</label>
                      <textarea
                        id="automation-description"
                        class="uba-textarea"
                        placeholder="Brief description of what this automation does"
                        rows="2"
                      ></textarea>
                    </div>

                    <div class="uba-form-row">
                      <div class="uba-form-group">
                        <label for="automation-trigger" data-i18n="automations.trigger">Trigger</label>
                        <select id="automation-trigger" class="uba-select">
                          <option value="" disabled selected>Select a trigger...</option>
                          <option value="invoice_created" data-i18n="triggers.invoiceCreated">Invoice Created</option>
                          <option value="invoice_status_changed" data-i18n="triggers.invoiceStatusChanged">Invoice Status Changed</option>
                          <option value="invoice_overdue" data-i18n="triggers.invoiceOverdue">Invoice Overdue</option>
                          <option value="client_created" data-i18n="triggers.clientCreated">Client Created</option>
                          <option value="task_created" data-i18n="triggers.taskCreated">Task Created</option>
                          <option value="task_completed" data-i18n="triggers.taskCompleted">Task Completed</option>
                        </select>
                      </div>
                      <div class="uba-form-group">
                        <label for="automation-action" data-i18n="automations.action">Action</label>
                        <select id="automation-action" class="uba-select">
                          <option value="" disabled selected>Select an action...</option>
                          <option value="create_task" data-i18n="actions.createTask">Create Task</option>
                          <option value="add_note_to_client" data-i18n="actions.addNoteToClient">Add Note to Client</option>
                          <option value="show_notification" data-i18n="actions.showNotification">Show Notification</option>
                          <option value="mark_invoice_as_overdue" data-i18n="actions.markInvoiceOverdue">Mark Invoice as Overdue</option>
                        </select>
                      </div>
                    </div>

                    <!-- Action Configuration -->
                    <div id="action-config" class="uba-form-group" style="display: none;">
                      <label id="config-label">Configuration</label>
                      
                      <!-- Create Task Config -->
                      <div id="config-create-task" class="config-section" style="display: none;">
                        <label for="config-task-title">Task Title Template</label>
                        <input
                          type="text"
                          id="config-task-title"
                          class="uba-input"
                          placeholder="e.g., Follow up with {client} on overdue invoice"
                          style="margin-bottom: 8px;"
                        />
                        <label for="config-days-offset">Days Offset (optional)</label>
                        <input
                          type="number"
                          id="config-days-offset"
                          class="uba-input"
                          placeholder="0"
                          min="0"
                          max="365"
                        />
                        <small style="color: var(--text-muted); font-size: 12px;">Number of days from trigger date (0 = today)</small>
                      </div>

                      <!-- Add Note Config -->
                      <div id="config-add-note" class="config-section" style="display: none;">
                        <label for="config-note-text">Note Template</label>
                        <textarea
                          id="config-note-text"
                          class="uba-textarea"
                          placeholder="e.g., Automated note: {trigger} occurred for {client}"
                          rows="3"
                        ></textarea>
                        <small style="color: var(--text-muted); font-size: 12px;">Use {client}, {amount}, {status}, {trigger} for dynamic values</small>
                      </div>

                      <!-- Notification Config -->
                      <div id="config-notification" class="config-section" style="display: none;">
                        <label for="config-notification-message">Notification Message</label>
                        <input
                          type="text"
                          id="config-notification-message"
                          class="uba-input"
                          placeholder="e.g., Alert: {client} invoice is now {status}"
                        />
                        <small style="color: var(--text-muted); font-size: 12px;">Use {client}, {amount}, {status}, {trigger} for dynamic values</small>
                      </div>

                      <!-- Mark Overdue Config -->
                      <div id="config-mark-overdue" class="config-section" style="display: none;">
                        <label for="config-overdue-days">Days After Due Date</label>
                        <input
                          type="number"
                          id="config-overdue-days"
                          class="uba-input"
                          placeholder="7"
                          min="0"
                          max="365"
                        />
                        <small style="color: var(--text-muted); font-size: 12px;">Automatically mark invoice as overdue after this many days past due date</small>
                      </div>
                    </div>

                    <div id="automation-error" class="uba-error-message" style="display: none;"></div>
                  </form>
                </div>
                <div class="uba-modal-footer">
                  <button type="button" class="uba-btn-ghost" onclick="closeAutomationModal()">
                    <span data-i18n="action.cancel">Cancel</span>
                  </button>
                  <button type="button" id="save-automation-btn" class="uba-btn-primary">
                    <span data-i18n="action.save">Save Automation</span>
                  </button>
                </div>
              </div>
            </div>
          </main>
        </div>
      </div>
    </section>

    <script src="assets/js/i18n.js"></script>
    <script src="assets/js/store.js"></script>
    <script src="assets/js/validation.js"></script>
    <script src="assets/js/app.js"></script>
    <script src="assets/js/page-loader.js"></script>
    <script src="assets/js/automations.js"></script>
  </body>
</html>
